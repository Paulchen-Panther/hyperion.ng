name: Hyperion CI/PR Builds
run-name: |
  ${{ github.event_name == 'push' && 'ðŸŒ± Push build -' || '' }}
  ${{ github.event_name == 'pull_request' && format('ðŸ“¦ Artifacts build for PR {0} - {1}', github.event.pull_request.number, github.event.pull_request.title) || github.event.head_commit.message }}

on:
  push:
    branches:
      - '**'
    tags:
      - '*'
  pull_request:
    branches:
      - 'master'

jobs:

########################################################
######  The following jobs are reusable workflows ######
########################################################

  # # GitHub Push/PR/Release
  # github_build:
  #   name: Qt ${{ matrix.qt_version }} Build ${{ matrix.qt_version == '6' && '(Testing))' || '' }}
  #   strategy:
  #     fail-fast: false
  #     matrix:
  #       qt_version: ['5', '6']
  #   uses: ./.github/workflows/qt5_6.yml
  #   secrets: inherit
  #   with:
  #     qt_version: ${{ matrix.qt_version }}
  #     event_name: ${{ github.event_name }}
  #     pull_request_number: ${{ github.event.pull_request.number }}
  #     publish: ${{ startsWith(github.event.ref, 'refs/tags') }}

  # # Build DEB Packages for APT Repository (runs only on tagged commits)
  # deb_build:
  #   name: ðŸ‘· Build DEB Packages
  #   # if: startsWith(github.event.ref, 'refs/tags')
  #   # needs: [ github_build ]
  #   uses: ./.github/workflows/repo_build_deb.yml
  #   secrets: inherit
  #   with:
  #     upload: true

  # Build RPM Packages for DNF Repository (runs only on tagged commits)
  rpm_build:
    name: ðŸ‘· Build RPM Packages
    # if: startsWith(github.event.ref, 'refs/tags')
    # needs: [ github_build ]
    uses: ./.github/workflows/repo_build_rpm.yml
    secrets: inherit
    with:
      upload: true

  # Publish RPM Packages to DNF Repository (runs only on tagged commits)
  publish_packages:
    name: ðŸš€ Publish Packages
    # if: startsWith(github.event.ref, 'refs/tags')
    # needs: [ deb_build, rpm_build ]
    needs: [ rpm_build ]
    uses: ./.github/workflows/repo_publish.yml
    secrets: inherit
    with:
      publish: true
