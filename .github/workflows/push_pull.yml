name: Hyperion CI/PR Builds
run-name: |
  ${{ github.event_name == 'push' && 'ðŸŒ± Push build -' || '' }}
  ${{ github.event_name == 'pull_request' && format('ðŸ“¦ Artifacts build for PR {0} - {1}', github.event.pull_request.number, github.event.pull_request.title) || github.event.head_commit.message }}

on:
  push:
    branches:
      - '**'
    tags:
      - '*'
  pull_request:
    branches:
      - 'master'

jobs:

########################################################
######  The following jobs are reusable workflows ######
########################################################

  # # GitHub Push/PR/Release
  # github_build:
  #   name: Qt ${{ matrix.qt_version }} Build ${{ matrix.qt_version == '6' && '(Testing))' || '' }}
  #   strategy:
  #     fail-fast: false
  #     matrix:
  #       qt_version: ['5', '6']
  #   uses: ./.github/workflows/qt5_6.yml
  #   secrets: inherit
  #   with:
  #     qt_version: ${{ matrix.qt_version }}
  #     event_name: ${{ github.event_name }}
  #     pull_request_number: ${{ github.event.pull_request.number }}
  #     publish: ${{ startsWith(github.event.ref, 'refs/tags') }}

  # Build DEB Packages for APT Repository (runs only on tagged commits)
  apt_build:
    name: ðŸ‘· APT Build Qt ${{ matrix.qt_version }}
    # if: startsWith(github.event.ref, 'refs/tags')
    # needs: [ github_build ]
    # strategy:
    #   fail-fast: false
    #   matrix:
    #     qt_version: ['5', '6']
    uses: ./.github/workflows/repo_build_deb.yml
    secrets: inherit
    with:
      # qt_version: ${{ matrix.qt_version }}
      qt_version: '6'
      upload: true

  # Publish DEB Packages to APT Repository (runs only on tagged commits)
  apt_publish:
    name: ðŸš€ Publish APT Packages
    # if: startsWith(github.event.ref, 'refs/tags')
    needs: [ apt_build ]
    uses: ./.github/workflows/repo_publish.yml
    secrets: inherit
    with:
      publish: true
      container: 'ubuntu'

  # # Build RPM Packages for DNF Repository (runs only on tagged commits)
  # dnf_build:
  #   name: ðŸ‘· DNF Build Qt ${{ matrix.qt_version }}
  #   if: startsWith(github.event.ref, 'refs/tags')
  #   needs: [ github_build ]
  #   strategy:
  #     fail-fast: false
  #     matrix:
  #       qt_version: ['5', '6']
  #   uses: ./.github/workflows/repo_build_rpm.yml
  #   secrets: inherit
  #   with:
  #     qt_version: ${{ matrix.qt_version }}
  #     publish: ${{ startsWith(github.event.ref, 'refs/tags') }}

  # # Publish RPM Packages to DNF Repository (runs only on tagged commits)
  # dnf_publish:
  #   name: ðŸš€ Publish RPM Packages
  #   if: startsWith(github.event.ref, 'refs/tags')
  #   needs: [ dnf_build ]
  #   uses: ./.github/workflows/repo_publish.yml
  #   secrets: inherit
  #   with:
  #     publish: true
  #     container: 'fedora'

